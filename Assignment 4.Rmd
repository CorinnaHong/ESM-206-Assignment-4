---
title: "Assignment 4"
author: "Corinna Hong"
date: "November 14, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, echo=FALSE}

library(tidyverse)
library(tidyr)
library(vcdExtra)
library(car)
library(onewaytests)
library(gridExtra)

```


```{r, include = FALSE}

# Read in data and put into tidy format

lobster_abundance <- read_csv("lobster_size_abundance.csv") %>% 
  as.data.frame(lobster_abundance) %>% # coerce tibbles into data.frame
  filter(COUNT != "0") %>% 
  expand.dft(freq = "COUNT") %>% # Give each lobster observation its own row
  select(YEAR, MONTH, DATE, SITE, SIZE)

lobster_traps <- read_csv("lobster_traps.csv") %>%
  filter(SITE == "IVEE"|SITE =="NAPL" |SITE == "AQUE"|SITE == "CARP" |SITE == "MOHK") %>% 
  select(YEAR, MONTH, DATE, SITE, TRAPS)

```

1. Lobster abundance and fishing pressure (2012 - 2017)

```{r, echo = FALSE, fig.height = 15, fig.width = 20}

# Create new datasets that group by site and then year. Total up # of obs for lobster measurements and sum number of traps

lobster_counts <- lobster_abundance %>%
  group_by(SITE, YEAR) %>% 
  summarize(
    COUNT = length(SIZE)
  )
  
traps_counts <- lobster_traps %>% 
  group_by(SITE, YEAR) %>% 
  summarize(
    TRAPS = sum(TRAPS))


# Merge data sets
abundance_traps <- full_join(lobster_counts, traps_counts) 

# Graph first set of data (number of lobsters)
abundance_traps_line <- ggplot(abundance_traps, aes(x = YEAR, y = COUNT)) + 
  geom_line(aes(color = "COUNT")) +
  geom_point() +
  facet_wrap(~SITE, scale = "free") +
  labs(x = "Year", y = "Count") +
  theme_classic() +
  theme(text = element_text(family="sans")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) + # rotate x-axis and move labels down
  theme(panel.spacing = unit(3, "lines"))
  

# Add the second data set (number of traps)
abundance_traps_line <- abundance_traps_line + geom_line(aes(y = TRAPS, color = "TRAPS")) + 
  geom_point(aes(y = TRAPS))
abundance_traps_line

```


2. Compare mean lobster size by site in 2017 

```{r}

# New dataframe for only year 2017

size_2017 <- lobster_abundance %>% 
  filter(YEAR == 2017) %>% 
  select(SITE, SIZE) 



# Data exploration

#Histograms

size_2017_hist <- ggplot(size_2017, aes(x = SIZE)) +
  geom_histogram(bins = 12) +
  facet_wrap(~ SITE, scale = "free") + # Create a histogram, split graphic visualization by site. Give each histogram its own y-axis scale
  theme_classic()
size_2017_hist


# QQ-Plots

size_2017_qq <- ggplot(size_2017, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE, scale = "free") + # Create a Q-Q plot, split graphic visualization by site. Give each Q-Q Plot its own y-axis scale
  theme_classic()
size_2017_qq



# Question: Is there a significant difference in mean lobster size between the five sites?

# H0: There is no significant difference in mean lobster size between the five sites
# HA: There is a significant difference in mean lobster size between the five sites



# Levene's Test 

# H0: There are no differences in varance across groups (variances are equal)
# HA: There are differences in variances across groups (variances are not equal)

lobster_levene <- leveneTest(SIZE ~ SITE, data = size_2017)
lobster_levene

# p < 0.05. Reject the null hypothesis. Our variances are differenct (Variances are not equal)



# What are the actual variances?

variances <- size_2017 %>% 
  group_by(SITE) %>% 
  summarize(
    mean = mean(SIZE),
    sd = sd(SIZE),
    variance = var(SIZE)
  )

# Our largest variance is less than 4x larger than our smallest variance



# ONE-WAY ANOVA:

lobster_aov <- aov(SIZE ~ SITE, data = size_2017)
lobster_sum_aov <- summary(lobster_aov)
lobster_sum_aov

lobster_ph <- TukeyHSD(lobster_aov)
lobster_ph

```



```{r}
# Box and whisker

lobster_box <- ggplot(size_2017, aes(x = SITE, y = SIZE)) +
  geom_boxplot(aes(fill = SITE, colour = SITE), alpha = 0.5, show.legend = FALSE) +
  ylab("Mean Lobster Size (mm)") +
  ggtitle("Lobster Sizes by Site (2017)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("Site") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))
lobster_box # Need to add a way to indicate significance

# Column graph of means 

lobster_col <- ggplot(variances, aes (x = SITE, y = mean)) +
  geom_col() +
  scale_y_continuous()
lobster_col

```

```{r}

# New data frame for year 2012

size_2012 <- lobster_abundance %>% 
  filter(YEAR == 2012) %>% 
  select(SITE, SIZE) 



# Data exploration

#Histograms

size_2012_hist <- ggplot(size_2012, aes(x = SIZE)) +
  geom_histogram(bins = 12) +
  facet_wrap(~ SITE, scale = "free") + # Create a histogram, split graphic visualization by site. Give each histogram its own y-axis scale
  theme_classic()
size_2012_hist


# QQ-Plots

<<<<<<< HEAD



# Add the second data set (traps)
abundance_traps_line <- abundance_traps_line + geom_line(aes(y = TRAPS, color = SITE), show.legend = FALSE) + 
  geom_point(aes(y = TRAPS, color = SITE), show.legend = FALSE)
abundance_traps_line
=======
size_2012_qq <- ggplot(size_2012, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE, scale = "free") + # Create a Q-Q plot, split graphic visualization by site. Give each Q-Q Plot its own y-axis scale
  theme_classic()
size_2012_qq
>>>>>>> d08e56537e416c4a92ea75a058965737af68d37a


<<<<<<< HEAD

```
=======
>>>>>>> d08e56537e416c4a92ea75a058965737af68d37a

# Question: How do lobster sizes in 2012 and 2017 compare?

# H0: There is no difference in mean lobster size in 2012 and 2017
# HA: There is a difference in mean lobster size in 2012 and 2017

# New dataframes with only MPA sites for 2012 and 2017

MPA_2012 <- size_2012 %>%
  filter(SITE == "IVEE" | SITE == "NAPL")
MPA_2012

MPA_2017 <- size_2017 %>%
  filter(SITE == "IVEE" | SITE == "NAPL")
MPA_2017


# F-test for equal variances:

# H0: Variances are equal
# HA: Variances are not equal

f_test <- var.test(MPA_2012$SIZE, MPA_2017$SIZE)

f_test

# p = 0.33, retain the null. Variacnes are equal.



# Two-sided t-test

MPA_ttest <- t.test(MPA_2012$SIZE, MPA_2017$SIZE, var.equal = TRUE)
MPA_ttest

#

```

