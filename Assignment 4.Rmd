---
title: "Assignment 4"
author: "Corinna Hong"
date: "November 14, 2018"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(tidyverse)
library(tidyr)
library(vcdExtra)
library(car)
library(onewaytests)

```


```{r, include = FALSE}

# Read in data and put into tidy format

lobster_abundance <- read_csv("lobster_size_abundance.csv") %>% 
  as.data.frame(lobster_abundance) %>% # coerce tibbles into data.frame
  filter(COUNT != "0") %>% 
  expand.dft(freq = "COUNT") %>% # Give each lobster observation its own row
  select(YEAR, MONTH, DATE, SITE, SIZE)

lobster_traps <- read_csv("lobster_traps.csv") %>%
  filter(SITE == "IVEE"| SITE == "IVEE"|SITE =="NAPL" |SITE == "AQUE"|SITE == "CARP" |SITE == "MOHK") %>% 
  select(YEAR, MONTH, DATE, SITE, TRAPS)

```

1. Lobster abundance and fishing pressure (2012 - 2017)

```{r}

# Create five graphs of each location with years on the x-axis and count of lobsters on y-axis

abundance_summary <- lobster_abundance %>% 
  group_by(SITE) %>% 
  count(YEAR) # Count how many observations there are in each year (data is grouped by site)
abundance_summary

abundance_col <- ggplot(abundance_summary, aes(x = YEAR, y = n)) +
  geom_col() +
  facet_wrap(~ SITE)
abundance_col

# Create graphs of trap buoys versus year at each site

trap_summary <- lobster_traps %>% 
  group_by(SITE) %>% 
  count(YEAR) # Count how many observations there are in each year (data is grouped by site)
trap_summary

trap_col <- ggplot(trap_summary, aes(x = YEAR, y = n)) +
  geom_col() +
  facet_wrap(~ SITE)
trap_col

```

2. Compare mean lobster size by site in 2017 

```{r}
# QUestion: Is there a significant difference in mean lobster size between the five sites

#H0: THere is no significant difference in mean lobster size between the five sites
#HA: There is a significant difference in mean lobster size between the five sites

# One-way ANOVA: We should use a one-way ANOVA, and need to test for normality (sample sizes are over 30 so we can use the central limit theorem) and equal variance (levene's test)

size_2017 <- lobster_abundance %>% 
  filter(YEAR == 2017) %>% 
  select(SITE, SIZE)

##Levene's Test:

## DO LEVENE'S TEST HERE

variances <- size_2017 %>% 
  group_by(SITE) %>% 
  summarize(
    mean = mean(SIZE),
    sd = sd(SIZE),
    variance = var(SIZE)
  )

lobster_levene <- leveneTest(SIZE ~ SITE, data = size_2017)
lobster_levene
  
# ?? Are variances equal? 

#ONE-WAY ANOVA:

lobster_aov <- aov(SIZE ~ SITE, data = size_2017)
lobster_sum_aov <- summary(lobster_aov)
lobster_sum_aov

lobster_ph <- TukeyHSD(lobster_aov)
lobster_ph


```



```{r}

lobster_box <- ggplot(size_2017, aes(x = SITE, y = SIZE)) +
  geom_boxplot(aes(fill = SITE, colour = SITE), alpha = 0.5, show.legend = FALSE) +
  ylab("Mean Lobster Size (mm)") +
  ggtitle("Lobster Sizes by Site (2017)") +
  xlab("Site") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))
lobster_box

```

```{r}
# Attempt at merging datasets

lobster_counts <- lobster_abundance %>%
  group_by(SITE, YEAR) %>% 
  summarize(
    count = length(SIZE)
  )

lobster_line <- ggplot(lobster_counts, aes(x = YEAR, y = count, group = SITE)) + 
  geom_line(aes(linetype = SITE, color = SITE))+
  theme_classic()+
  geom_point(aes(color = SITE))+
  labs(x = "Year", y = "Lobster Abundance")
  
lobster_line
  
traps_counts <- lobster_traps %>% 
  group_by(SITE, YEAR) %>% 
  summarize(
    sum = sum(TRAPS))

traps_counts

traps_line <- ggplot(traps_counts, aes(x = YEAR, y = sum, group = SITE)) + 
  geom_line(aes(linetype = SITE, color = SITE))+
  theme_classic()+
  geom_point(aes(color = SITE))+
  labs(x = "Year", y = "Traps Adundance")

traps_line
```

